{% extends "base.html" %}

{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'backlog/tarea_edit.css' %}?v=1">

{% endblock %}


{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>✏️ Editar Tarea</h2>

  {% if request.user.is_authenticated %}
  <div class="text-end">
    <a href="{% url 'home' %}" class="btn btn-secondary">🏠 Home</a>
    <span class="mx-2">👤 {{ request.user.first_name|default:request.user.username }}</span>
    <a href="{% url 'logout' %}" class="btn btn-danger">🚪 Cerrar Sesión</a>
  </div>
  {% endif %}
</div>

<div class="alert alert-warning">
  ⚠️ Estás editando la tarea <strong>"{{ tarea.titulo }}"</strong>.
  Los cambios serán visibles para todo el equipo.
</div>

<form method="post" enctype="multipart/form-data" class="card shadow-sm p-4">
  {% csrf_token %}
  <div class="row g-3">
    <div class="col-md-6">{{ form.epica.label_tag }} {{ form.epica }}</div>
    <div class="col-md-6">{{ form.sprint.label_tag }} {{ form.sprint }}</div>

    <div class="col-md-12">{{ form.titulo.label_tag }} {{ form.titulo }}</div>
    <div class="col-md-12">{{ form.descripcion.label_tag }} {{ form.descripcion }}</div>
    <div class="col-md-12">
      {{ form.criterios_aceptacion.label_tag }} {{ form.criterios_aceptacion }}
      {% if form.criterios_aceptacion.help_text %}<small class="text-muted">{{ form.criterios_aceptacion.help_text }}</small>{% endif %}
    </div>

    <div class="col-md-4">{{ form.categoria.label_tag }} {{ form.categoria }}</div>
    <div class="col-md-4">{{ form.esfuerzo_sp.label_tag }} {{ form.esfuerzo_sp }}</div>

    <!-- 🔹 nuevos responsables -->
    <div class="col-md-4">
      {{ form.asignados.label_tag }}
      {{ form.asignados }}
      {% if form.asignados.help_text %}<small class="text-muted">{{ form.asignados.help_text }}</small>{% endif %}
    </div>
  </div>

  <div class="mt-4 d-flex gap-2">
    <button type="submit" class="btn btn-success">💾 Guardar Cambios</button>
    <a href="{% url 'detalle_tarea' tarea.id %}" class="btn btn-secondary">❌ Cancelar</a>
  </div>
</form>

<div class="mt-4 d-flex flex-wrap gap-2">
  <a href="{% url 'detalle_tarea' tarea.id %}" class="btn btn-info">👁️ Ver Detalle</a>
  <a href="{% url 'backlog_lista' %}" class="btn btn-primary">📋 Backlog</a>
  <a href="{% url 'kanban_board' %}" class="btn btn-success">🧩 Kanban</a>
</div>

{% endblock %}
