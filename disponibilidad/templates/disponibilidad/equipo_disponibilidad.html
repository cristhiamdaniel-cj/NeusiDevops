{% extends "base.html" %}
{% load disponibilidad_extras %}
{% block title %}Disponibilidad del Equipo (Semana){% endblock %}

{% block content %}
<div class="container py-4">

  <div class="d-flex align-items-center justify-content-between mb-3">
    <div class="d-flex gap-2">
      <a class="btn btn-light border" href="{{ home_url }}">‚Ü© Volver</a>
      <a class="btn btn-outline-primary" href="{{ mi_url }}">üôã‚Äç‚ôÇÔ∏è Mi disponibilidad</a>
    </div>
    <div class="btn-group">
      <a class="btn btn-outline-secondary" href="?semana={{ prev_w|date:'Y-m-d' }}{% if grupo_sel %}&grupo={{ grupo_sel }}{% endif %}">‚Üê Semana anterior</a>
      <span class="btn btn-light disabled">
        {{ semana_inicio|date:"d M" }} ‚Äî {{ semana_inicio|add_days:6|date:"d M Y" }}
      </span>
      <a class="btn btn-outline-secondary" href="?semana={{ next_w|date:'Y-m-d' }}{% if grupo_sel %}&grupo={{ grupo_sel }}{% endif %}">Semana siguiente ‚Üí</a>
    </div>
  </div>

  <form class="row g-2 mb-3">
    <input type="hidden" name="semana" value="{{ semana_inicio|date:'Y-m-d' }}">
    <div class="col-12 col-md-6">
      <label class="form-label">Grupo</label>
      <select class="form-select" name="grupo" onchange="this.form.submit()">
        <option value="">‚Äî Todos ‚Äî</option>
        {% for g in grupos %}
          <option value="{{ g.id }}" {% if grupo_sel|default:''|stringformat:'s' == g.id|stringformat:'s' %}selected{% endif %}>{{ g.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-12 col-md-6 d-flex align-items-end">
      <button class="btn btn-outline-primary">Filtrar</button>
    </div>
  </form>

  <div class="table-responsive">
    <table class="table table-sm align-middle">
      <thead class="table-light">
        <tr>
          <th>Usuario</th>
          {% for i in "0123456" %}
            <th class="text-center">
              {{ semana_inicio|add_days:forloop.counter0|date:"D" }}<br>
              <small class="text-muted">{{ semana_inicio|add_days:forloop.counter0|date:"Y-m-d" }}</small>
            </th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for row in rows %}
          <tr>
            <td>
              <strong>{{ row.user.get_full_name|default:row.user.username }}</strong><br>
              <small class="text-muted">{{ row.user.email }}</small>
            </td>
            {% for d in row.sem.dias.all %}
              <td class="text-center">
                <span class="badge {% if d.tipo == 'D' %}text-bg-success{% elif d.tipo == 'N' %}text-bg-secondary{% else %}text-bg-info{% endif %}"
                      title="{{ d.display_largo }}">
                  {% if d.tipo == "D" %}Disp.{% elif d.tipo == "N" %}No{% else %}
                    {% if d.hora_inicio and d.hora_fin %}
                      {{ d.hora_inicio|time:"H:i" }}‚Äì{{ d.hora_fin|time:"H:i" }}
                    {% else %}Rango{% endif %}
                  {% endif %}
                </span>
              </td>
            {% endfor %}
          </tr>
        {% empty %}
          <tr><td colspan="8" class="text-center text-muted">Sin usuarios para este filtro.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}
